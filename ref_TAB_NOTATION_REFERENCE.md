# Guitar & Bass Note Reference (For Coding)

この資料は、ギターとベースの音名 + オクターブ番号と、TAB 位置の対応を示す。
アプリ内でオクターブ表記／指板表示／TAB 変換処理を実装する際の基準として使用する。

---

## ギターの移調記譜とベースの実音記譜

### ギターの移調ルール

> [!IMPORTANT]
> **ギター譜は1オクターブ上げて記譜します（実音より高く書く）**

- **ト音記号の五線譜一番下の線**: E4（記譜音）
- **ギターの実音**: E3（1弦12フレット）
- **理由**: 低音域を読みやすくするため

**例:**
- 記譜: E4 → 実音: E3
- 記譜: C5 → 実音: C4
- 記譜: G5 → 実音: G4

### ベースの記譜ルール

> [!NOTE]
> **ベースは「1オクターブ移調楽器」です**

- **記譜**: ヘ音記号（Bass Clef）を使用します。
- **実音**: 記譜された音より **1オクターブ低い音** が鳴ります。
- **アプリ実装**: 
  - **譜面表示**: ヘ音記号の第2間を「C3」の位置として描画します。
  - **音源再生**: 内部的には「C2 (MIDI 36)」として処理・再生します（Transpose -12）。

---

## ギター全フレット対応表（6弦、EADGBE）

| 弦 | 開放音 | 1フレット | 2フレット | 3フレット | 5フレット | 7フレット | 12フレット | 24フレット |
|----|--------|-----------|-----------|-----------|-----------|-----------|------------|------------|
| 6E | E2     | F2        | F#2       | G2        | A2        | B2        | E3         | E4         |
| 5A | A2     | A#2       | B2        | C3        | D3        | E3        | A3         | A4         |
| 4D | D3     | D#3       | E3        | F3        | G3        | A3        | D4         | D5         |
| 3G | G3     | G#3       | A3        | A#3       | C4        | D4        | G4         | G5         |
| 2B | B3     | C4        | C#4       | D4        | E4        | F#4       | B4         | B5         |
| 1E | E4     | F4        | F#4       | G4        | A4        | B4        | E5         | E6         |

**実用範囲:**
- 最低音: E2（6弦開放、MIDI 40）
- 最高音: E6（1弦24フレット、MIDI 88）

---

## ベース全フレット対応表（4弦、EADG）

| 弦 | 開放音 | 1フレット | 2フレット | 3フレット | 5フレット | 7フレット | 12フレット | 24フレット |
|----|--------|-----------|-----------|-----------|-----------|-----------|------------|------------|
| 4E | E1     | F1        | F#1       | G1        | A1        | B1        | E2         | E3         |
| 3A | A1     | A#1       | B1        | C2        | D2        | E2        | A2         | A3         |
| 2D | D2     | D#2       | E2        | F2        | G2        | A2        | D3         | D4         |
| 1G | G2     | G#2       | A2        | A#2       | C3        | D3        | G3         | G4         |

**実用範囲:**
- 最低音: E1（4弦開放、MIDI 28）
- 最高音: G4（1弦24フレット、MIDI 67）

---

## ギターの基準音（Standard Tuning: EADGBE）

ギターの音域はおおむね **E2〜E6**。  
以下は代表的な音のサンプルと TAB 位置。

### ● 開放弦の音名とオクターブ

| 弦 | 音名 | オクターブ | MIDI番号 |
|----|------|-----------|---------|
| 1弦 | E | 4 | 64 |
| 2弦 | B | 3 | 59 |
| 3弦 | G | 3 | 55 |
| 4弦 | D | 3 | 50 |
| 5弦 | A | 2 | 45 |
| 6弦 | E | 2 | 40 |

### ● 6弦開放（E2）
```
E|----
B|----
G|----
D|----
A|----
E|--0-
```

---

## 楽器の音域（Range）

### ギター（Guitar）

**標準的な音域:**
- **最低音**: E2（6弦開放） = MIDI 40
- **最高音**: E6（1弦24フレット） = MIDI 88
- **実用音域**: E2〜E6（49半音 = 4オクターブ）

> [!NOTE]
> 24フレットギターを想定。22フレットの場合は最高音がD6（MIDI 86）になります。

### ベース（4弦ベース）

**標準的な音域:**
- **最低音**: E1（4弦開放） = MIDI 28
- **最高音**: G4（1弦24フレット） = MIDI 67
- **実用音域**: E1〜G4（40半音 = 約3オクターブ）

> [!WARNING]
> これらの範囲外の音符を入力しようとするとエラーが表示されます。

---

## 実装向けポイント（変換ロジックの基準）

### MIDI番号と音名の対応

MIDI番号は以下の式で計算される：
```
MIDI番号 = (オクターブ + 1) × 12 + 音名のインデックス
```

音名のインデックス（C = 0基準）：
- C = 0, C# = 1, D = 2, D# = 3, E = 4, F = 5, F# = 6, G = 7, G# = 8, A = 9, A# = 10, B = 11

### TAB位置の計算

各弦の開放音のMIDI番号を基準に、フレット番号は半音差で計算：
```typescript
フレット番号 = 目標MIDI番号 - 開放弦MIDI番号
```

### ギターとベースの音域差

- **ギター**: 主要音域は E2（MIDI 40）〜 E6（MIDI 88）
- **ベース**: 主要音域は E1（MIDI 28）〜 G4（MIDI 67）
- ベースはギターより **約1オクターブ低い**

---

## 教則本に基づく運指とTAB生成の指針

### 1. ベースの運指スタイル（1 Finger per Fret vs 3 Finger）

教則本（Column: ウッド・ベースの演奏法）に基づき、TAB生成時に考慮すべき運指ロジック。

| スタイル | 特徴 | TAB生成への適用 |
|---|---|---|
| **エレキベース奏法** | **1フレット＝1指** (1 Finger per Fret)<br>4フレットの範囲を人差指〜小指でカバーする。 | クロマチックな動きや、広い音程跳躍を含むフレーズで優先。<br>フレット移動を最小限に抑えるロジック。 |
| **ウッドベース奏法** | **1-2-4奏法** (Simandl Method)<br>人差指(1)、中指(2)、小指(4)を使用。<br>薬指は小指の補助。半音階3つ分をカバー。 | ローポジション（第1〜第5ポジション）での生成時に優先。<br>無理なストレッチを避け、開放弦を積極的に活用する。 |

### 2. ギターのポジション移動（ブロック・コード）

教則本（Lesson 9: コード・トーンを弾いてみよう）に基づく。

- **6弦ルート / 5弦ルート**:
  コードのルート音が6弦または5弦にあるポジションを基準に、その周囲でフレーズを展開する。
  アプリのTAB生成では、現在のコードのルート位置に近いポジションを優先的に選択すると、演奏しやすいTABになる。

### 3. 異名同音（Enharmonic）の優先順位

教則本（Lesson 2: 指板上の音名を覚えよう）より。

> "ジャズのスタンダード曲はフラット系のキーの曲が圧倒的に多いので、音名も♭表記で呼ぶことが多い"

- **デフォルト設定**:
  特に指定がない場合、黒鍵（派生音）は **フラット（♭）表記** を優先する（例: A# ではなく Bb）。
- **キー依存**:
  Key G, D, A, E などのシャープ系キーでは ♯ を使用する。

## ジャズ特有の記譜法とTAB表現

### ゴーストノート（Ghost Notes / Dead Notes）

ベースラインやバッキングで多用される、音程を持たないパーカッシブな音。

- **記号**: 符頭を `x` にする。
- **TAB表記**: フレット番号の代わりに `x` を表示。
- **MIDI処理**: 短く、ピッチのない打撃音（またはミュート音）として再生。

### リズム・スラッシュ（Rhythmic Slash）

コードバッキング（コンピング）のリズムのみを示す記法。

- **記号**: 五線譜の中央（第3線）に、符幹付きのスラッシュ符頭を表示。
- **意味**: 「このリズムで、指定されたコードを弾く」。
- **アプリ実装**: 
  - コード記号が指定されている小節で「リズム譜モード」を有効にした場合に表示。

### キメ（Rhythmic Figures）とアンティシペーション

- **アンティシペーション（食う）**:
  小節の終わりの裏拍（8分音符裏など）で次の小節のコードを先取りして弾くこと。
- **記譜**: 
  タイで次の小節の頭（1拍目）と繋ぐ。
  アプリのバリデーションでは、小節をまたぐタイの入力を正しく認識・許容する必要がある。

---

## アプリでの使用例

### 音名からTAB位置を計算
```typescript
const openStrings = instrument === 'guitar' 
  ? [64, 59, 55, 50, 45, 40]  // E4, B3, G3, D3, A2, E2
  : [43, 38, 33, 28];          // G2, D2, A1, E1

const targetMidi = 60; // C4
openStrings.forEach((openMidi, stringIndex) => {
  const fret = targetMidi - openMidi;
  if (fret >= 0 && fret <= 24) {
    console.log(`弦${stringIndex + 1}、フレット${fret}`);
  }
});
```

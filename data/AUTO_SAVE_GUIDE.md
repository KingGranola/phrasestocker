# データフォルダへの自動保存機能

## 🎯 機能概要

保存ボタンを押すと、LocalStorageへの保存と同時に、`data/`フォルダに自動的にJSONファイルとして保存されます。

---

## 🚀 初回セットアップ

### 1. dataフォルダの指定

アプリを起動後、初めて保存する際に、フォルダ選択ダイアログが表示されます。

1. プロジェクトフォルダ内の **`data`** フォルダを選択
2. 「選択」または「Open」をクリック
3. 以降、このフォルダに自動保存されます

> **重要**: 必ずプロジェクト内の `data/` フォルダを選択してください。

### 2. ブラウザ対応状況

| 機能 | Chrome/Edge | Firefox | Safari |
|------|-------------|---------|--------|
| 自動保存 | ✅ サポート | ❌ 自動DL | ❌ 自動DL |

- **Chrome/Edge**: File System Access API により、指定フォルダに直接保存
- **Firefox/Safari**: 自動ダウンロード（手動でdataフォルダに移動が必要）

---

## 💡 使い方

### 通常の保存フロー

```
1. フレーズを編集
2. 「SAVE」ボタンをクリック
3. 自動的に以下2箇所に保存:
   ├─ LocalStorage（ブラウザ内）
   └─ data/<フレーズ名>.json（ファイル）
```

### ファイル名の規則

```
元のフレーズ名: "II-V-I リック (Cmaj)"
↓
保存されるファイル名: "II-V-I_リック__Cmaj_.json"
```

- 特殊文字は `_` に置換
- 日本語はそのまま使用可能

---

## 🔧 トラブルシューティング

### Q. フォルダ選択ダイアログが表示されない

**A. ブラウザがFile System Access APIに対応していません**

- Chrome または Edge の最新版を使用してください
- Firefox/Safari では自動ダウンロードになります

### Q. 毎回フォルダを選択するよう求められる

**A. ブラウザの権限が保持されていません**

chrome://flags で以下を有効化:
```
#file-system-access-persistent-permission
```

または、毎回選択が表示される場合は、ダウンロードフォルダから手動で移動してください。

### Q. ファイルが data/ フォルダに保存されない

**A. 以下を確認してください**

1. **正しいフォルダを選択したか**
   - プロジェクト内の `data/` フォルダを選択する必要があります

2. **ブラウザのコンソールを確認**
   - F12 → Console タブでエラーメッセージを確認

3. **フォルダの書き込み権限**
   - data/ フォルダに書き込み権限があるか確認

### Q. Firefoxで使用したい

**A. 自動ダウンロードモードで動作します**

1. 保存すると自動的にダウンロード
2. ダウンロードされたファイルを手動で `data/` に移動
3. これで同じ効果が得られます

---

## ⚙️ 設定のリセット

データフォルダの設定をリセットして、再選択したい場合:

```typescript
// ブラウザのコンソールで実行
localStorage.removeItem('dataFolderName');
```

次回保存時に再度フォルダ選択ダイアログが表示されます。

---

## 📂 保存されるファイルの例

### 単一フレーズ
```json
{
  "id": "unique-id-12345",
  "name": "II-V-I リック",
  "tags": ["II-V-I", "Lick"],
  "instrument": "guitar",
  "bpm": 120,
  "keySignature": "C",
  "scale": "major",
  "measures": [...],
  "updatedAt": 1732779245123
}
```

---

## 🎓 ベストプラクティス

### 1. 定期的な確認

```bash
# data/ フォルダの中身を確認
ls -la data/
```

### 2. バックアップ併用

自動保存は便利ですが、念のため：
- 週1回、手動で「ライブラリ全体をエクスポート」してbackupsフォルダに保存
- 重要なフレーズは複数箇所に保存

### 3. Gitで管理

```bash
git add data/
git commit -m "Add new jazz licks"
```

data/ フォルダをGitで管理すると、変更履歴が追えます。

---

## 🔐 プライバシーとセキュリティ

- **ローカルのみで完結**: データは外部に送信されません
- **ブラウザの権限**: 初回選択時のみフォルダアクセス権限が必要
- **ファイル上書き**: 同名ファイルは上書きされます（バージョン管理推奨）

---

## 📝 まとめ

### 自動保存の流れ

```
保存ボタンクリック
    ↓
LocalStorageに保存
    ↓
dataフォルダに自動保存
    ↓
完了通知
```

### メリット

- ✅ データ喪失のリスク低減
- ✅ 手動エクスポート不要
- ✅ すぐにファイルとしてアクセス可能
- ✅ バージョン管理が容易

---

**これで、保存するだけでファイルが自動的に作成されます！** 🎵
